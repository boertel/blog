---
layout: default
title: rewards
---

<div class="user-section">
    <div id="loader" class="ajax-loader"></div>

    <div id="disconnected" style="display: none;">
        <h1>Get some cookies</h1>

        <button id="join">Enter the cookie stash</button>
    </div>

    <div id="connected" style="display: none;">
        <div class="box">
            <h3>Hej <span id="username"></span>!</h3>
            <p>You collected <span class="pt-point chocolate-chip"></span> chocolate chips.</p>
        </div>

        <div id="anchor-reward" class="box"></div>

        <div id="anchor-leaderboard" class="box"></div>

        <div id="anchor-activity" class="box"></div>

        <h4>How can you get more chocolate chips?</h4>
        <p>Read articles, share content and more (you thought I was going to tell you all the tricks?!).</p>
    </div>
</div>

<div class="footer">Custom implementation of <span class="ribbon"></span><a href="//www.punchtab.com" target="_blank">PunchTab</a> if you have questions about this program? Contact me by <a href="mailto:ben+blog@punchtab.com">email</a> | <a href="#" id="log-user">Log in</a></div>


<script id="template-reward" type="text/html" data-anchor="anchor-reward">
    <h4>What is the next cookie you can get?</h4>
    <div class="reward">
        <div class="image">
            <img src="[[image.original_image]]">
        </div>
        <div class="text">
            [[label]]
            <div class="action">
                <a href="#">Get It Now!</a>
            </div>
        </div>
    </div>
</script>

<script id="template-activity" type="text/html" data-anchor="anchor-activity">
<h4>How did you earn the last <span class="chocolate-chip">[[points]]</span> chocolate chips?</h4>
<ul class="activities">
[[#activities]]
    <li><span class="chocolate-chip">[[strPoints]]</span> [[activityReason]] this <a href="[[referrer]]">article</a><span class="onhover date"> – [[humanDate]]</span></li>
[[/activities]]
</ul>
</script>

<script id="template-leaderboard" type="text/html" data-anchor="anchor-leaderboard">
<h4>How do you do against others visitors?</h4>
<ul>
[[#array]]
    <li [[#self]]class="me"[[/self]]>[[rank]]. [[name]] – <span class="chocolate-chip">[[strPoints]]</span></li>
[[/array]]
</ul>
</script>

<script type="text/javascript" src="/js/hogan.js"></script>
<script type="text/javascript" src="/js/barbe.js"></script>
<script>
// Configure Barbe
function ptApi (args) {
    return PT.api.call(args.url, args);
}
Barbe.init({
    ajax: ptApi
});

window.ptReady = window.ptReady || [];
window.ptReady.push(function () {

    PT.event.bind('user.connected', function () {
        myRewards.connected();
    });

    PT.event.bind('user.disconnected', function () {
        myRewards.disconnected();
    });

    PT.event.bind('user.updated', function () {
        PT.dom.$('username').innerHTML = PT.user.name;
    });
   
});

var myRewards = {};

myRewards.connected = function () {
    PT.dom.$('loader').style.display = "none";
    PT.dom.$('log-user').innerHTML = "Log out";
    PT.dom.$('log-user').onclick = function () {
        PT.event.trigger('connect.disconnect');
    };

    PT.dom.$('disconnected').style.display = "none";
    PT.dom.$('connected').style.display = "block";

    myRewards.reward();
    myRewards.activity();
    myRewards.leaderboard();
};

myRewards.reward = function () {
    new Barbe.View('template-reward', {
        url: "/reward",
        data: {sort: "closest"},
        success: function (response) {
            return response[0];
        }
    }).grow();
};
myRewards.activity = function () {
    new Barbe.View('template-activity', {
        url: "/activity",
        data: {scope: "user", limit: 10},
        success: function (response) {
            var points = 0;
            for (var i = 0; i < response.length; i += 1) {
                response[i].activityReason = PT.i18n.getActivityReason(response[i].name);
                response[i].humanDate = PT.util.dateTimeToTimeAgo(response[i].date_created);
                response[i].strPoints = PT.util.intcomma(response[i].points);
                points += response[i].points;
            }
            return {points: PT.util.intcomma(points), activities: response};
        }
    }).grow();
};
myRewards.leaderboard = function () {
    new Barbe.View('template-leaderboard', {
        url: '/leaderboard',
        data: {'with': "me"},
        success: function (response) {
            for (var i = 0; i < response.length; i += 1) {
                response[i].strPoints = PT.util.intcomma(response[i].points);
            }
        }
    }).grow();
};

myRewards.disconnected = function () {
    PT.dom.$('loader').style.display = "block";
    PT.dom.$('log-user').innerHTML = "Log in";
    PT.dom.$('log-user').onclick = function () {};
    PT.widget.connect.attachConnect(PT.dom.$('join'));
    PT.widget.connect.attachConnect(PT.dom.$('log-user'));

    PT.dom.$('connected').style.display = "none";
    PT.dom.$('disconnected').style.display = "block";
};
</script>
